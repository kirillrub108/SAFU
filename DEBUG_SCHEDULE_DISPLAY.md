# Отладка отображения расписания

## Проблема
API возвращает события, но они не отображаются в интерфейсе.

## Исправления

### 1. Упрощено сравнение дат в ScheduleGrid
**Проблема**: `parseISO` и `isSameDay` могли работать некорректно с датами без времени.

**Решение**: Прямое сравнение дат по компонентам (год, месяц, день):
```typescript
const [year, month, date] = eventDateStr.split('-').map(Number)
const sameDay = year === dayYear && month - 1 === dayMonth && date === dayDate
```

### 2. Добавлена отладочная информация
- В консоль браузера выводятся данные о событиях
- `DebugInfo` компонент показывает детальную информацию
- Логи в `Timetable.tsx` для отслеживания данных

### 3. Исправлен порядок инициализации
`useEffect` теперь устанавливает текущую неделю до вызова `useTimetable`.

## Шаги для проверки

### Шаг 1: Откройте страницу расписания
```
http://localhost:5173/timetable
```

### Шаг 2: Откройте консоль браузера (F12)
Проверьте логи:
- `Timetable - Events received:` - показывает полученные события
- `Event debug:` - показывает сравнение дат (только первые 3 события)

### Шаг 3: Проверьте Debug Info на странице
Должна быть желтая панель с информацией:
- Даты запроса
- Количество полученных событий
- Первые 5 событий с деталями

### Шаг 4: Проверьте API напрямую
```powershell
# Проверьте, что API возвращает данные
curl "http://localhost:8000/api/timetable?date_from=2024-11-18&date_to=2024-11-24"
```

### Шаг 5: Проверьте формат дат
В консоли браузера проверьте:
- Формат `event.time_slot.date` (должен быть `YYYY-MM-DD`)
- Формат `filters.dateFrom` и `filters.dateTo` (должны быть `YYYY-MM-DD`)
- Совпадение дат событий с датами недели

## Возможные проблемы

### Проблема 1: События не совпадают с текущей неделей
**Решение**: Переключитесь на неделю, где есть события (17-22 ноября 2025), или перезапустите seed:
```powershell
docker compose exec backend python -m app.seeds.main
```

### Проблема 2: Неправильный формат дат
**Решение**: Проверьте, что API возвращает даты в формате `YYYY-MM-DD`. Если нет - исправьте в `backend/app/api/routes/timetable.py`.

### Проблема 3: События не фильтруются по паре
**Решение**: Проверьте, что `event.time_slot.pair_number` совпадает с номером пары в таблице (1-8).

### Проблема 4: Неправильная неделя
**Решение**: Нажмите кнопку "Сегодня" в `WeekSelector`, чтобы вернуться к текущей неделе.

## Что проверить в коде

1. **ScheduleGrid.tsx** - функция `getEventsForDayAndPair`:
   - Правильно ли парсится дата из `event.time_slot.date`
   - Правильно ли сравниваются даты
   - Правильно ли сравниваются номера пар

2. **Timetable.tsx** - компонент:
   - Правильно ли передается `weekStart` в `ScheduleGrid`
   - Правильно ли обрабатываются события

3. **useTimetable.ts** - хук:
   - Правильно ли формируется запрос
   - Правильно ли обрабатывается ответ

4. **filters.ts** - store:
   - Правильно ли устанавливается текущая неделя
   - Правильно ли обновляются даты при смене недели

## Дополнительная отладка

Если проблема сохраняется, добавьте больше логов:

```typescript
// В ScheduleGrid.tsx, в функции getEventsForDayAndPair
console.log('Comparing:', {
  day: `${dayYear}-${dayMonth + 1}-${dayDate}`,
  eventDate: eventDateStr,
  sameDay,
  pairNumber,
  eventPair: event.time_slot.pair_number,
  match: sameDay && samePair
})
```

## Ожидаемый результат

После исправлений:
1. События должны отображаться в правильных ячейках таблицы
2. Каждая ячейка соответствует дню недели и номеру пары
3. Debug Info показывает правильные данные
4. Консоль не показывает ошибок

